/* CSS3 Finalize - v1.0 - 2013-02-24 - Grid Layout Polyfill
* https://github.com/codler/Grid-Layout-Polyfill
* Copyright (c) 2013 Han Lin Yap http://yap.nu; http://creativecommons.org/licenses/by-sa/3.0/ */
function cssTextToObj(h){var c=h.split(/({[^{}]*})/);if(c[c.length-1].indexOf("}")==-1){c.pop()}var d=[];var a=false;var j;var f=0;var g;var e=0;while(e<c.length){if(e%2===0){var b=$.trim(c[e]);if(a){if(b.indexOf("}")!=-1){b=b.substr(1);c[e]=b;g=c.splice(f,e-f);g.shift();g.unshift(j[1]);d[d.length-1].attributes=cssTextToObj(g.join(""));a=false;e=f;continue}}else{if(b.indexOf("{")!=-1){j=b.split("{");b=$.trim(j[0]);a=true;f=e}if(b!==""){d.push({selector:b})}}}else{if(!a){d[d.length-1].attributes=cssTextAttributeToObj(c[e].substr(1,c[e].length-2))}}e++}return d}function cssTextAttributeToObj(c){var b;c=c.replace(/url\(([^)]+)\)/g,function(d){return d.replace(/;/g,"[cssFinalize]")});b=c.split(/(:[^;]*;?)/);b.pop();var a={};$.map(b,function(e,d){if(d%2==1){a[$.trim(b[d-1])]=$.trim(e.substr(1).replace(";","").replace(/url\(([^)]+)\)/g,function(f){return f.replace(/\[cssFinalize\]/g,";")}))}});return a}jQuery(function(h){var c=/(^|\s)(?:\w+)/g;var b=/\.[\w\d_-]+/g;var a=/#[\w\d_-]+/g;var k=function(m){var o=m.match(c);var q=o?o.length:0;o=m.match(b);var p=o?o.length:0;o=m.match(a);var n=o?o.length:0;return q+10*p+100*n};console.clear();var i=cssTextToObj(h("style").text());console.log(i);var g=l(i);console.log(g);function l(n){var m=[];h.each(n,function(o,p){if(p.attributes){if(p.attributes.display=="-ms-grid"){m.push({selector:p.selector,attributes:p.attributes,tracks:f(p.attributes)})}}});return m}function f(n){var p=n["-ms-grid-columns"].split(" "),o=n["-ms-grid-rows"].split(" ");var m=[];h.each(o,function(q,r){m[q]=[];h.each(p,function(t,s){m[q][t]={x:r,y:s}})});return m}h.each(g,function(n,o){h(o.selector).children().css({"box-sizing":"border-box",position:"absolute",top:0,left:0,width:o.tracks[0][0].x,height:o.tracks[0][0].y}).each(function(s,t){var p=h(this);var w=d(p);w.sort(function(B,A){B=k(B);A=k(A);if(B<A){return -1}else{if(B>A){return 1}else{return 0}}});console.log(w);var r=j(i,w.pop());if(!r){return true}var z=r["-ms-grid-row"]||1;var q=r["-ms-grid-column"]||1;var x=r["-ms-grid-column-span"]||1;var u=r["-ms-grid-row-span"]||1;var y=e(o.tracks,z,q,u,x);var v=e(o.tracks,1,1,z-1,q-1);console.log(y);console.log(v);h(this).css({top:v.y,left:v.x,width:y.x,height:y.y})});var m=e(o.tracks,1,1,o.tracks.length,o.tracks[0].length);h(o.selector).css({position:"relative","box-sizing":"border-box",width:(o.attributes.display=="-ms-grid")?"100%":m.x,height:m.y})});function j(o,m){var n;h.each(o,function(p,q){if(q.selector==m){n=q.attributes;return false}});return n}function e(m,t,p,o,n){t--;p--;var s={x:0,y:0};for(var q=0;q<o;q++){if(m[t+q][p].y.indexOf("fr")===-1){s.y+=parseFloat(m[p][t+q].y)}}for(var u=0;u<n;u++){if(m[t][p+u].x.indexOf("fr")===-1){s.x+=parseFloat(m[p+u][t].x)}}return s}function d(p){var o=[];for(var m=0;m<document.styleSheets.length;m++){var r=document.styleSheets[m].cssRules;for(var n=0;n<r.length;n++){try{if(p.is(r[n].selectorText)){o.push(r[n].selectorText)}}catch(q){}}}return o}});